<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Assistente de Conex√£o RTSP ‚Äî dmtech</title>
  <style>
    :root {
      --primary: #00b8a9; /* Turquesa principal */
      --secondary: #ffb300; /* Amarelo ouro */
      --dark: #0b0b0b;
      --light: #f4f4f4;
    }

    body {
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, var(--dark) 0%, #111 100%);
      color: var(--light);
      padding: 40px;
      text-align: center;
      margin-bottom: 100px;
    }

    h2 {
      color: var(--primary);
      letter-spacing: 1px;
      margin-bottom: 20px;
    }

    h3 {
      color: var(--secondary);
    }

    input {
      width: 60%;
      padding: 12px;
      font-size: 16px;
      margin: 8px 0;
      border-radius: 30px;
      border: 2px solid var(--primary);
      outline: none;
      transition: 0.3s;
      background: #111;
      color: var(--light);
    }

    input:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 10px var(--secondary);
    }

    button {
      padding: 12px 28px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 25px;
      cursor: pointer;
      border: none;
      background: var(--primary);
      color: #fff;
      transition: 0.3s;
    }

    button:hover {
      background: var(--secondary);
      color: #111;
    }

    table {
      border-collapse: collapse;
      margin: 30px auto;
      width: 90%;
      max-width: 900px;
      color: #fff;
      border-radius: 8px;
      overflow: hidden;
    }

    th {
      background-color: var(--primary);
      padding: 12px;
    }

    td {
      background: rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid #222;
      padding: 10px;
    }

    tr:hover {
      background: rgba(0, 184, 169, 0.15);
      cursor: pointer;
    }

    code {
      background-color: #111;
      padding: 4px 8px;
      border-radius: 4px;
      color: var(--secondary);
    }

    .step { display: none; }
    .active { display: block; }

    #viewer {
      position: relative;
      margin-top: 20px;
      display: inline-block;
      border-radius: 12px;
      overflow: hidden;
      width: 640px;
      height: 360px;
      background: #000;
      box-shadow: 0 0 20px rgba(0, 184, 169, 0.3);
    }

    #stream {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: none;
    }

    #status4 {
      margin-top: 10px;
      font-weight: 500;
      color: var(--light);
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .wizard-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #0b0b0b;
      border-top: 2px solid var(--primary);
      padding: 16px;
      display: flex;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.4);
    }
  </style>
</head>

<body>
  <h2>üìπ Assistente de Conex√£o de C√¢meras RTSP</h2>

  <div id="step1" class="step active">
    <h3>1Ô∏èInforme o usu√°rio e senha padr√£o das c√¢meras</h3>
    <input id="user" placeholder="Usu√°rio (ex: admin)" value="admin"><br>
    <input id="pass" placeholder="Senha (ex: 12345)" type="password"><br>
  </div>

  <div id="step2" class="step">
    <h3>2Ô∏èInforme o IP e a porta RTSP da c√¢mera</h3>
    <input id="ip" placeholder="IP (ex: 192.168.15.10)" value="192.168.15.10"><br>
    <input id="port" placeholder="Porta RTSP (ex: 554)" value="546"><br>
  </div>

  <div id="step3" class="step">
    <h3>3Ô∏èInforme a url de conex√£o com a camera ou clique no modelo na tabela abaixo.</h3>
    <input id="rtspUrl" placeholder="rtsp://usuario:senha@ip:porta/path"><br>
    <p id="status3a"></p>
    <table id="cameraTable">
      <thead><tr><th>Fabricante / Firmware</th><th>Clique na marca da sua camera para preencher e altere se for necess√°rio</th></tr></thead>
      <tbody id="cameraTableBody"></tbody>
    </table>
  </div>

  <div id="step4" class="step">
    <h3>4Ô∏è Visualiza√ß√£o da C√¢mera</h3>
    <div id="viewer">
      <div id="spinner" class="spinner"></div>
      <img id="stream" alt="stream">
    </div>
    <div id="status4">üîå Tentando conectar...</div>
  </div>

  <div class="wizard-footer">
    <button id="backBtn">Voltar</button>
    <button id="nextBtn">Avan√ßar</button>
  </div>

  <script>
    const steps = [step1, step2, step3, step4];
    let currentStep = 0;

    const userInput = document.getElementById('user');
    const passInput = document.getElementById('pass');
    const ipInput = document.getElementById('ip');
    const portInput = document.getElementById('port');
    const rtspInput = document.getElementById('rtspUrl');
    const tableBody = document.getElementById('cameraTableBody');
    const streamImg = document.getElementById('stream');
    const spinner = document.getElementById('spinner');
    const status4 = document.getElementById('status4');
    const nextBtn = document.getElementById('nextBtn');
    const backBtn = document.getElementById('backBtn');

    const templates = [
      { name: 'Dahua / Intelbras / Tecvoz / Greatek', path: '/cam/realmonitor?channel=1&subtype=0' },
      { name: 'Hikvision / Multilaser', path: '/Streaming/Channels/101' },
      { name: 'Provision / Luxvision', path: '/Streaming/Channels/1' },
      { name: 'TP-Link / Tapo', path: '/stream1' },
      { name: 'Foscam / Wanscam / gen√©ricas', path: '/videoMain' },
      { name: 'Amcrest / Reolink / Annke', path: '/cam/realmonitor?channel=1&subtype=0' },
      { name: 'ONVIF (padr√£o universal)', path: '/Streaming/Channels/101' }
    ];

    function showStep(index) {
      steps.forEach(s => s.classList.remove('active'));
      steps[index].classList.add('active');
      currentStep = index;
      backBtn.style.display = index === 0 ? 'none' : 'inline-block';
      nextBtn.textContent = index === steps.length - 1 ? 'Finalizar' : 'Avan√ßar';
      status4.textContent = '';
      spinner.style.display = 'none';
      streamImg.style.display = 'none';
    }

    function preencherTabela(user, pass, ip, port) {
      tableBody.innerHTML = '';
      templates.forEach(t => {
        const url = `rtsp://${user}:${pass}@${ip}:${port}${t.path}&rtsp_transport=tcp`;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><b>${t.name}</b></td><td><code>${url}</code></td>`;
        tr.onclick = () => {
          rtspInput.value = url;
        };
        tableBody.appendChild(tr);
      });
    }

    async function tryConnect() {
      const rtspUrl = rtspInput.value.trim();
      if (!rtspUrl) return alert('Selecione ou informe uma URL RTSP.');

      spinner.style.display = 'block';
      streamImg.style.display = 'none';

      try {
        const { url } = await window.cameraApi.startStream({ rtspUrl, id: 'cam1' });
        streamImg.onload = () => {
          spinner.style.display = 'none';
          streamImg.style.display = 'block';
        };
        streamImg.onerror = () => {
          spinner.style.display = 'none';
          status4.textContent = '‚ùå Erro ao carregar stream. Verifique IP, porta ou credenciais.';
        };
        streamImg.src = url;
      } catch (err) {
        spinner.style.display = 'none';
        status4.textContent = `‚ùå Falha: ${err.message}`;
      }
    }

    nextBtn.onclick = async () => {
      if (currentStep === 0) {
        if (!userInput.value || !passInput.value) return alert('Preencha usu√°rio e senha.');
        showStep(1);
      } else if (currentStep === 1) {
        if (!ipInput.value || !portInput.value) return alert('Informe IP e porta RTSP.');
        preencherTabela(userInput.value, passInput.value, ipInput.value, portInput.value);
        showStep(2);
      } else if (currentStep === 2) {
        if (!rtspInput.value.trim()) return alert('Selecione ou informe uma URL RTSP.');
        showStep(3);
        await tryConnect();
      } else {
        window.close();
      }
    };

    backBtn.onclick = () => showStep(currentStep - 1);
    showStep(0);
  </script>
</body>
</html>
